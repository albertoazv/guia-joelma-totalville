<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia do Morador - Total Ville 06</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; scroll-behavior: smooth; }
        [x-cloak] { display: none !important; }
        .tab-active { border-bottom: 3px solid #2563eb; color: #2563eb; font-weight: 700; }
        .gradient-bg { background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); }
        .custom-scrollbar::-webkit-scrollbar { height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .chat-container { height: 350px; overflow-y: auto; }
        .message-ai { background-color: #f0f7ff; align-self: flex-start; border-radius: 1rem 1rem 1rem 0; }
        .message-user { background-color: #e2e8f0; align-self: flex-end; border-radius: 1rem 1rem 0 1rem; }
        
        /* Animação de carregamento da IA */
        .typing-dot { width: 6px; height: 6px; background: #3b82f6; border-radius: 50%; animation: typing 1s infinite ease-in-out; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    </style>

    <!-- ARQUITETURA DE MÓDULOS -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, collection, onSnapshot, updateDoc, writeBatch, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import Alpine from "https://unpkg.com/alpinejs@3.14.1/dist/module.esm.js";

        // =================================================================================
        // ⚠️ CONFIGURAÇÕES DEFINITIVAS ⚠️
        // =================================================================================
        
        // 1. API KEY DO GEMINI (IA)
        const apiKey = "AIzaSyBxxaQeowUexe2jFpgL85Jvjhm9BxP_yA0"; 

        // 2. CONFIGURAÇÃO DO FIREBASE (PROJETO GUIA JOELMA)
        const defaultFirebaseConfig = {
            apiKey: "AIzaSyCVYGGCCxHblfcS3siikbExo2OzVs4skRc",
            authDomain: "guia-joelma-totalville.firebaseapp.com",
            projectId: "guia-joelma-totalville",
            storageBucket: "guia-joelma-totalville.firebasestorage.app",
            messagingSenderId: "429149501288",
            appId: "1:429149501288:web:604699f4e3278871da88dd"
        };
        
        const rawFirebaseConfig = typeof __firebase_config !== 'undefined' ? __firebase_config : JSON.stringify(defaultFirebaseConfig);
        // =================================================================================

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'guia-joelma-06';
        let app, auth, db;
        let firebaseReady = false;

        // Inicializa o Firebase
        try {
            const config = JSON.parse(rawFirebaseConfig);
            app = initializeApp(config);
            auth = getAuth(app);
            db = getFirestore(app);
            firebaseReady = true;
            console.log("Firebase conectado com sucesso!");
        } catch (e) {
            console.error("Erro fatal ao conectar Firebase:", e);
        }

        // --- Funções de IA (Gemini) ---
        async function callWithRetry(fn, maxRetries = 3) {
            for (let i = 0; i < maxRetries; i++) {
                try { return await fn(); } 
                catch (e) { if (i === maxRetries - 1) throw e; await new Promise(r => setTimeout(r, 1000 * Math.pow(2, i))); }
            }
        }

        async function callGemini(prompt, systemInstruction = "") {
            if (!apiKey) return "⚠️ Erro: Chave de API do Gemini inválida.";
            return callWithRetry(async () => {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: systemInstruction ? { parts: [{ text: systemInstruction }] } : undefined
                    })
                });
                if (!response.ok) throw new Error('API Error');
                const result = await response.json();
                return result.candidates?.[0]?.content?.parts?.[0]?.text || "Não consegui responder agora.";
            });
        }

        async function callTTS(text) {
            if (!apiKey) return null;
            return callWithRetry(async () => {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Say clearly: ${text}` }] }],
                        generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } } } }
                    })
                });
                const result = await response.json();
                const base64Audio = result.candidates[0].content.parts[0].inlineData.data;
                const binaryString = atob(base64Audio);
                const bytes = new Int16Array(binaryString.length / 2);
                for (let i = 0; i < binaryString.length; i += 2) {
                    bytes[i / 2] = binaryString.charCodeAt(i) | (binaryString.charCodeAt(i + 1) << 8);
                }
                return pcmToWav(bytes, 24000);
            });
        }

        function pcmToWav(pcmData, sampleRate) {
            const buffer = new ArrayBuffer(44 + pcmData.length * 2);
            const view = new DataView(buffer);
            const writeString = (offset, string) => { for (let i = 0; i < string.length; i++) view.setUint8(offset + i, string.charCodeAt(i)); };
            writeString(0, 'RIFF'); view.setUint32(4, 32 + pcmData.length * 2, true); writeString(8, 'WAVE'); writeString(12, 'fmt ');
            view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, 1, true); view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true); view.setUint16(32, 2, true); view.setUint16(34, 16, true); writeString(36, 'data');
            view.setUint32(40, pcmData.length * 2, true);
            for (let i = 0; i < pcmData.length; i++) view.setInt16(44 + i * 2, pcmData[i], true);
            return new Blob([view], { type: 'audio/wav' });
        }

        // --- Lógica do App (Alpine Component) ---
        const paymentSystem = () => ({
            activeTab: 'home',
            user: null,
            isAdmin: false,
            firebaseMissing: !firebaseReady,
            nextDueDate: 'Carregando...',
            lastPaymentStatus: 'Carregando...',
            
            // IA
            aiQuestion: '',
            isAiLoading: false,
            isTtsLoading: false,
            chatHistory: [],
            contractSummary: '',
            isContractLoading: false,
            installQuestion: '',
            installSolution: '',
            isInstallLoading: false,

            tabs: [
                { id: 'home', label: 'Início', icon: 'fa-house' },
                { id: 'apartamento', label: 'Apê', icon: 'fa-building' },
                { id: 'eletrica', label: 'Elétrica', icon: 'fa-bolt' },
                { id: 'financeiro', label: 'Contas', icon: 'fa-shield-heart' },
                { id: 'agenda', label: 'Aluguel', icon: 'fa-calendar-days' },
                { id: 'documentos', label: 'Docs', icon: 'fa-folder-open' },
                { id: 'ai', label: 'Assistente ✨', icon: 'fa-sparkles' }
            ],
            payments: [],

            async init() {
                const urlParams = new URLSearchParams(window.location.search);
                this.isAdmin = urlParams.get('mode') === 'admin';

                if (!firebaseReady) {
                    this.chatHistory.push({ role: 'ai', text: '⚠️ Erro de conexão com Firebase. Verifique as credenciais.' });
                    return;
                }

                try {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        // Tenta login anônimo. Se falhar por falta de configuração no console, avisa.
                        await signInAnonymously(auth).catch(e => {
                            console.error("Erro no Login Anônimo:", e);
                            alert("Erro de autenticação: Verifique se o Login Anônimo está ativado no console do Firebase.");
                        });
                    }
                } catch (e) { console.error("Erro Auth Geral:", e); }

                onAuthStateChanged(auth, (user) => {
                    this.user = user;
                    if (user) this.setupDatabaseListener();
                });

                this.chatHistory.push({ role: 'ai', text: 'Olá Joelma! Sou seu assistente ✨. O que precisa saber sobre o Total Ville 06 hoje?' });
            },

            setupDatabaseListener() {
                if (!this.user || !firebaseReady) return;
                const paymentsRef = collection(db, 'artifacts', appId, 'public', 'data', 'payments');
                onSnapshot(paymentsRef, (snapshot) => {
                    if (snapshot.empty) { this.seedDatabase(); return; }
                    this.payments = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort((a, b) => a.order - b.order);
                    this.updateSummary();
                }, (err) => console.error("Erro Firestore:", err));
            },

            async seedDatabase() {
                const months = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                const batch = writeBatch(db);
                const paymentsRef = collection(db, 'artifacts', appId, 'public', 'data', 'payments');
                months.forEach((m, i) => {
                    batch.set(doc(paymentsRef), { month: m, date: `10/${(i+1).toString().padStart(2, '0')}/2026`, status: 'Pendente', order: i });
                });
                await batch.commit();
            },

            updateSummary() {
                const next = this.payments.find(p => p.status === 'Pendente' || p.status === 'Em Análise');
                this.nextDueDate = next ? next.date : 'Ciclo Completo';
                const last = [...this.payments].reverse().find(p => p.status === 'Confirmado');
                this.lastPaymentStatus = last ? last.month + ' ✅' : 'Nenhum';
            },

            async handleFileUpload(e) {
                if (!this.user || !firebaseReady) { alert("Erro de conexão."); return; }
                const month = this.payments.find(p => p.status === 'Pendente');
                if (month) {
                    const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'payments', month.id);
                    await updateDoc(docRef, { status: 'Em Análise', updatedAt: serverTimestamp() });
                    alert(`Comprovante de ${month.month} marcado como 'Em Análise'!`);
                }
            },

            async approvePayment(id) {
                if (!this.user || !this.isAdmin || !firebaseReady) return;
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'payments', id);
                await updateDoc(docRef, { status: 'Confirmado' });
            },

            getStatusClass(status) {
                switch(status) {
                    case 'Confirmado': return 'bg-green-100 text-green-700';
                    case 'Em Análise': return 'bg-blue-100 text-blue-700';
                    default: return 'bg-slate-100 text-slate-500';
                }
            },

            copyPix() { navigator.clipboard.writeText('018.523.841-66'); alert('Chave PIX copiada!'); },

            // --- Ações IA ---
            async askAi() {
                if (!this.aiQuestion.trim()) return;
                const q = this.aiQuestion;
                this.chatHistory.push({ role: 'user', text: q });
                this.aiQuestion = '';
                this.isAiLoading = true;
                
                // Prompt enriquecido com dados do contrato
                const systemPrompt = `
                    Você é o assistente virtual do apartamento Total Ville 06. 
                    Locador: Bruno de Almeida Amorim (Representado pelo Curador José Alberto Tomaz de Azevedo Filho).
                    Inquilina: Joelma Macedo Pereira.
                    
                    REGRAS DO CONTRATO (Assinado em 30/12/2025):
                    - Proibido furar paredes (concreto pré-moldado).
                    - Voltagem 220V. Chuveiro max 4600W.
                    - Limpeza caixa gordura mensal.
                    - Pagamento: Todo dia 10.
                    - Chave PIX: 018.523.841-66 (Bruno).
                    
                    Emergências: Alberto (61) 98265-6721.
                    Responda sempre de forma curta e amigável.
                `;
                
                const res = await callGemini(q, systemPrompt);
                this.chatHistory.push({ role: 'ai', text: res });
                this.isAiLoading = false;
                
                this.$nextTick(() => { const c = document.getElementById('chatContainer'); if(c) c.scrollTop = c.scrollHeight; });
            },

            async speakAi(text) {
                this.isTtsLoading = true;
                const audioBlob = await callTTS(text);
                if (audioBlob) {
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audio = new Audio(audioUrl);
                    audio.play();
                }
                this.isTtsLoading = false;
            },

            async summarizeContract() {
                this.isContractLoading = true;
                const prompt = "Resuma para a Joelma: Vigência (30/12/25 a 29/12/26), Data de Pagamento (dia 10), Valor, Proibição de Furos e PIX do Bruno. Use emojis.";
                this.contractSummary = await callGemini(prompt);
                this.isContractLoading = false;
            },

            async getInstallConsult() {
                if (!this.installQuestion.trim()) return;
                this.isInstallLoading = true;
                const prompt = `Estou num apartamento de concreto pré-moldado onde é PROIBIDO furar paredes. Como posso instalar ou colocar: "${this.installQuestion}"? Dê 3 opções criativas (ex: fita 3M, móvel de chão, suporte de teto, ventosa).`;
                this.installSolution = await callGemini(prompt);
                this.isInstallLoading = false;
            }
        });

        Alpine.data('paymentSystem', paymentSystem);
        Alpine.start();
    </script>
</head>
<body class="bg-slate-50 text-slate-900" x-data="paymentSystem" x-cloak>

    <!-- HEADER DE AVISO (Se faltar Firebase) -->
    <div x-show="firebaseMissing" class="bg-red-100 text-red-800 text-xs text-center p-2 font-bold border-b border-red-200 sticky top-0 z-[60]">
        <i class="fa-solid fa-triangle-exclamation mr-1"></i> AVISO: Configuração do Firebase falhou ou está pendente.
    </div>

    <!-- HEADER DE ADMIN (Visível apenas se ?mode=admin) -->
    <div x-show="isAdmin && !firebaseMissing" class="bg-amber-100 text-amber-800 text-xs text-center p-2 font-bold border-b border-amber-200 sticky top-0 z-[60]">
        <i class="fa-solid fa-lock-open mr-1"></i> MODO ADMINISTRADOR (APROVAÇÃO HABILITADA)
    </div>

    <!-- HERO SECTION -->
    <header class="gradient-bg text-white pb-20 pt-10 px-6 rounded-b-[3rem] shadow-2xl relative overflow-hidden">
        <div class="max-w-4xl mx-auto text-center relative z-10">
            <div class="inline-block bg-blue-500/30 backdrop-blur-md px-4 py-1 rounded-full text-sm font-semibold mb-4 border border-blue-400/30">
                Residencial Total Ville 06
            </div>
            <h1 class="text-4xl md:text-5xl font-extrabold mb-4 tracking-tight">Guia Digital Joelma</h1>
            <p class="text-blue-100 text-lg mb-8 max-w-xl mx-auto opacity-90">
                Gestão inteligente para uma moradia tranquila ✨.
            </p>
            <div class="flex flex-wrap justify-center gap-4">
                <button @click="activeTab = 'ai'" class="bg-white text-blue-700 font-bold py-3 px-6 rounded-full shadow-lg hover:bg-blue-50 transition transform hover:scale-105">
                    Assistente IA ✨
                </button>
                <button @click="activeTab = 'agenda'" class="bg-blue-500 text-white font-bold py-3 px-6 rounded-full border border-blue-400 hover:bg-blue-600 transition">
                    Pagamentos
                </button>
            </div>
        </div>
    </header>

    <!-- NAVIGATION -->
    <nav class="sticky top-8 z-50 bg-white shadow-md -mt-10 mx-4 md:mx-auto max-w-4xl rounded-2xl border border-slate-200">
        <div class="flex overflow-x-auto custom-scrollbar whitespace-nowrap p-2">
            <template x-for="tab in tabs" :key="tab.id">
                <button @click="activeTab = tab.id" 
                        :class="activeTab === tab.id ? 'tab-active' : 'text-slate-500'"
                        class="flex items-center gap-2 px-4 py-3 text-sm font-semibold transition-all hover:bg-slate-50 rounded-lg">
                    <i :class="tab.icon"></i> <span x-text="tab.label"></span>
                </button>
            </template>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="max-w-4xl mx-auto px-4 py-8 mb-20">

        <!-- HOME -->
        <section x-show="activeTab === 'home'" x-transition x-cloak>
            <div class="bg-white rounded-3xl p-8 border border-slate-200 shadow-sm text-center">
                <h2 class="text-2xl font-bold mb-6">Status do Mês</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-6 bg-blue-50 rounded-3xl border border-blue-100 flex items-center gap-4 text-left">
                        <div class="w-12 h-12 bg-blue-600 text-white rounded-2xl flex items-center justify-center text-xl shadow-lg">
                            <i class="fa-solid fa-calendar"></i>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500 font-bold uppercase tracking-wider">Próximo Vencimento</p>
                            <p class="font-extrabold text-slate-800 text-lg" x-text="nextDueDate"></p>
                        </div>
                    </div>
                    <div class="p-6 bg-green-50 rounded-3xl border border-green-100 flex items-center gap-4 text-left">
                        <div class="w-12 h-12 bg-green-600 text-white rounded-2xl flex items-center justify-center text-xl shadow-lg">
                            <i class="fa-solid fa-check-double"></i>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500 font-bold uppercase tracking-wider">Último Confirmado</p>
                            <p class="font-extrabold text-slate-800 text-lg" x-text="lastPaymentStatus"></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- APARTAMENTO & CONSULTOR ✨ -->
        <section x-show="activeTab === 'apartamento'" x-transition x-cloak>
            <div class="space-y-6">
                <div class="bg-red-50 border-2 border-red-200 rounded-3xl p-6">
                    <h3 class="text-xl font-bold text-red-900 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-ban"></i> Paredes de Concreto (Importante)
                    </h3>
                    <p class="text-red-800 text-sm leading-relaxed mb-4">
                        O prédio utiliza tecnologia de concreto pré-moldado. **É estritamente proibido furar as paredes.**
                    </p>
                    <div class="bg-white p-4 rounded-2xl border border-red-100 flex items-center gap-3">
                        <i class="fa-solid fa-lightbulb text-amber-500"></i>
                        <p class="text-xs text-slate-600"><strong>Dica:</strong> Fixe tudo no teto ou use fitas de alta aderência.</p>
                    </div>
                </div>

                <div class="bg-white border border-blue-100 rounded-3xl p-6 shadow-sm">
                    <h3 class="font-bold text-lg mb-4 text-blue-800 flex items-center gap-2">
                        Consultor de Instalação ✨
                    </h3>
                    <p class="text-sm text-slate-600 mb-4">Quer instalar algo? Pergunte à IA como fazer sem furar a parede:</p>
                    <div class="flex gap-2 mb-4">
                        <input type="text" x-model="installQuestion" placeholder="Ex: Como pendurar uma TV ou quadros?" class="flex-1 rounded-xl border-slate-200 text-sm">
                        <button @click="getInstallConsult()" :disabled="isInstallLoading" class="bg-blue-600 text-white px-4 rounded-xl font-bold hover:bg-blue-700 disabled:opacity-50 transition">
                            Consultar ✨
                        </button>
                    </div>
                    <div x-show="isInstallLoading" class="flex justify-center py-4">
                        <div class="typing-dot mx-1"></div><div class="typing-dot mx-1"></div><div class="typing-dot mx-1"></div>
                    </div>
                    <div x-show="installSolution" class="bg-blue-50 p-4 rounded-2xl text-sm text-blue-900 leading-relaxed whitespace-pre-wrap border border-blue-100" x-text="installSolution"></div>
                </div>
            </div>
        </section>

        <!-- ELÉTRICA -->
        <section x-show="activeTab === 'eletrica'" x-transition x-cloak>
            <div class="bg-white p-8 rounded-3xl border border-slate-200">
                <div class="bg-red-600 text-white p-4 rounded-2xl mb-6 flex items-center gap-4 text-left">
                    <i class="fa-solid fa-triangle-exclamation text-2xl"></i>
                    <div>
                        <p class="font-bold">CAPACIDADE ELÉTRICA: 4600W</p>
                        <p class="text-xs opacity-90">Não instale chuveiros que excedam esta potência para evitar derretimento da fiação.</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-center">
                    <div class="p-4 bg-slate-50 rounded-2xl">
                        <p class="text-xs font-bold text-slate-400 mb-1">VOLTAGEM</p>
                        <p class="text-2xl font-black text-slate-800 tracking-tighter">220 VOLTS</p>
                    </div>
                    <div class="p-4 bg-slate-50 rounded-2xl">
                        <p class="text-xs font-bold text-slate-400 mb-1">MANUTENÇÃO</p>
                        <p class="text-sm font-bold text-slate-700">Responsabilidade Inquilina</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- FINANCEIRO -->
        <section x-show="activeTab === 'financeiro'" x-transition x-cloak>
            <div class="space-y-4">
                <div class="bg-blue-600 text-white p-8 rounded-3xl shadow-lg">
                    <h3 class="font-bold mb-4 flex items-center gap-2"><i class="fa-solid fa-shield-fire"></i> Seguro Incêndio</h3>
                    <p class="text-sm opacity-90 leading-relaxed">Obrigatório manter ativo com o locador Bruno Amorim como beneficiário.</p>
                </div>
                <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                    <h3 class="font-bold mb-4 text-slate-800">Pagamento via PIX</h3>
                    <div class="flex justify-between items-center p-4 bg-slate-50 rounded-2xl">
                        <span class="font-bold text-slate-800">018.523.841-66</span>
                        <button @click="copyPix()" class="text-blue-600 font-bold bg-blue-50 px-3 py-1 rounded-lg">Copiar</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- AGENDA DE PAGAMENTOS -->
        <section x-show="activeTab === 'agenda'" x-transition x-cloak>
            <div class="space-y-6">
                <div class="bg-white rounded-3xl border-2 border-dashed border-blue-300 p-8 text-center">
                    <h3 class="text-xl font-bold mb-2">Enviar Comprovante</h3>
                    
                    <!-- UPLOAD PARA MORADOR -->
                    <div x-show="!isAdmin && !firebaseMissing">
                        <input type="file" id="fileInput" @change="handleFileUpload" class="hidden">
                        <label for="fileInput" class="cursor-pointer bg-blue-600 text-white font-bold py-3 px-8 rounded-2xl hover:bg-blue-700 transition inline-block">
                            Selecionar Arquivo
                        </label>
                    </div>
                    <div x-show="firebaseMissing" class="text-sm text-red-500">
                        Configure o Firebase para habilitar envios.
                    </div>
                    <!-- TEXTO PARA ADMIN -->
                    <div x-show="isAdmin" class="text-sm text-slate-400 italic">
                        (Upload visível apenas para morador. Aprove abaixo.)
                    </div>
                </div>

                <div class="bg-white rounded-3xl border border-slate-200 overflow-hidden shadow-sm">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 border-b border-slate-100 text-[10px] text-slate-400 uppercase font-bold">
                                <tr><th class="p-4">Mês</th><th class="p-4">Valor</th><th class="p-4">Status</th><th class="p-4 text-center">Ações</th></tr>
                            </thead>
                            <tbody class="text-sm divide-y divide-slate-100">
                                <template x-for="item in payments" :key="item.id">
                                    <tr :class="item.status === 'Confirmado' ? 'bg-green-50/20' : ''">
                                        <td class="p-4">
                                            <p class="font-bold text-slate-800" x-text="item.month"></p>
                                            <p class="text-[10px] text-slate-500" x-text="item.date"></p>
                                        </td>
                                        <td class="p-4 font-bold text-green-600">R$ 1.400,00</td>
                                        <td class="p-4"><span :class="getStatusClass(item.status)" class="px-2 py-1 rounded-full text-[10px] font-bold" x-text="item.status"></span></td>
                                        <td class="p-4 text-center">
                                            <!-- APROVAÇÃO (ADMIN) -->
                                            <button @click="approvePayment(item.id)" 
                                                    x-show="isAdmin && item.status === 'Em Análise'" 
                                                    class="bg-blue-600 text-white text-[10px] px-3 py-1 rounded-full font-bold hover:bg-blue-700 transition shadow-lg transform hover:scale-105">
                                                Aprovar ✨
                                            </button>
                                            <span x-show="!isAdmin && item.status === 'Em Análise'" class="text-xs text-slate-400 italic">Enviado</span>
                                            <span x-show="item.status === 'Confirmado'" class="text-xs text-green-600 font-bold flex justify-center"><i class="fa-solid fa-check"></i></span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- DOCUMENTOS & RESUMO ✨ -->
        <section x-show="activeTab === 'documentos'" x-transition x-cloak>
            <div class="space-y-6">
                <div class="bg-white rounded-3xl p-8 border border-slate-200">
                    <h3 class="font-bold text-xl mb-4 text-slate-800">Central de Documentos</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8">
                        <a href="Contrato_Locacao_Total_Ville_assinado_assinado_assinado_assinado.pdf" target="_blank" class="flex items-center gap-4 p-4 bg-slate-50 rounded-2xl border hover:bg-blue-50 border-slate-100 group">
                            <div class="bg-red-100 text-red-600 p-3 rounded-xl"><i class="fa-solid fa-file-pdf"></i></div>
                            <div><p class="font-bold text-slate-800">Contrato Assinado</p><p class="text-[10px] text-slate-400 uppercase font-bold tracking-tight">Ver Original</p></div>
                        </a>
                    </div>

                    <div class="border-t border-slate-100 pt-6">
                        <h4 class="font-bold mb-4 flex items-center gap-2">Resumo Inteligente ✨</h4>
                        <button @click="summarizeContract()" :disabled="isContractLoading" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-xl hover:bg-indigo-700 disabled:opacity-50 transition">
                            Gerar Resumo ✨
                        </button>
                        <div x-show="isContractLoading" class="flex justify-center py-6">
                            <div class="typing-dot mx-1"></div><div class="typing-dot mx-1"></div><div class="typing-dot mx-1"></div>
                        </div>
                        <div x-show="contractSummary" class="mt-6 bg-slate-50 p-6 rounded-2xl border border-slate-200 text-sm leading-relaxed whitespace-pre-wrap" x-text="contractSummary"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ASSISTENTE IA ✨ -->
        <section x-show="activeTab === 'ai'" x-transition x-cloak>
            <div class="bg-white rounded-3xl p-6 border border-slate-200 shadow-sm flex flex-col">
                <div id="chatContainer" class="chat-container border border-slate-100 rounded-2xl p-4 mb-4 flex flex-col gap-3">
                    <template x-for="msg in chatHistory">
                        <div :class="msg.role === 'ai' ? 'message-ai' : 'message-user'" class="max-w-[85%] p-4 text-sm leading-relaxed relative group shadow-sm">
                            <p x-text="msg.text"></p>
                            <button x-show="msg.role === 'ai'" @click="speakAi(msg.text)" class="absolute -right-8 top-2 text-slate-300 hover:text-blue-500 transition no-print" title="Ouvir">
                                <i class="fa-solid fa-volume-high" :class="isTtsLoading ? 'animate-pulse text-blue-500' : ''"></i>
                            </button>
                        </div>
                    </template>
                    <div x-show="isAiLoading" class="message-ai p-4 text-sm flex gap-1 items-center">
                        <div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
                    </div>
                </div>
                <div class="flex gap-2">
                    <input type="text" x-model="aiQuestion" @keyup.enter="askAi()" placeholder="Tire sua dúvida com a IA..." class="flex-1 rounded-2xl border-slate-200 text-sm p-4 focus:ring-blue-500 shadow-inner">
                    <button @click="askAi()" :disabled="isAiLoading" class="bg-blue-600 text-white p-4 rounded-2xl hover:bg-blue-700 disabled:opacity-50 transition shadow-lg">
                        <i class="fa-solid fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </section>

    </main>

    <!-- FOOTER -->
    <footer class="bg-white border-t border-slate-200 py-12 px-6 pb-24 text-center">
        <p class="text-sm font-bold text-slate-700">Curador: Alberto Azevedo - (61) 98265-6721</p>
    </footer>

    <button onclick="window.print()" class="no-print fixed bottom-8 right-8 bg-blue-600 text-white w-14 h-14 rounded-full shadow-2xl flex items-center justify-center hover:scale-110 transition z-50">
        <i class="fa-solid fa-print"></i>
    </button>

</body>
</html>